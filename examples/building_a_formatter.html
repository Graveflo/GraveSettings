<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="API Documentation" href="../api.html" /><link rel="prev" title="Using Handlers" href="using_handlers.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Custom Formatter - grave_settings 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">grave_settings 0.1.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">grave_settings 0.1.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Directory</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../limitations.html">Limitations</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../limitations/security_concerns.html">Security Concerns</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_reference.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/semantics.html">Semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/handlers.html">Handler Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/formatters.html">Formatters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/bases.html">User Object Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/conversion_manager.html">Conversion Manager</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="settings_base_classes.html">Settings Bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_config_file.html">Config File Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="preserving_references.html">Preserving References</a></li>
<li class="toctree-l2"><a class="reference internal" href="circular_references.html">Circular References</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_handlers.html">Using Handlers</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Custom Formatter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.abstract.html">abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.config_file.html">config_file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.conversion_manager.html">conversion_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.default_handlers.html">default_handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.formatter.html">formatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.formatter_settings.html">formatter_settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.framestack_context.html">framestack_context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.helper_objects.html">helper_objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.semantics.html">semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.utilities.html">utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.validation.html">validation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/modules.html">Formatters</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="custom-formatter">
<h1>Custom Formatter<a class="headerlink" href="#custom-formatter" title="Permalink to this heading">#</a></h1>
<p>Lets use the python package <a class="reference external" href="https://docs.python.org/3/library/configparser.html#module-configparser" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> to build a custom formatter. This package is meant for “ini like” files but we will re-purpose it to make a custom format.</p>
<p>The first thing we have to do is decide which types are going to be “primitive” and which types are going to be “special”. It looks to me like <a class="reference external" href="https://docs.python.org/3/library/configparser.html#module-configparser" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> doesnt have many default types, just strings and mappings. We’ll expand on this.</p>
<section id="making-the-spec">
<h2>Making the Spec<a class="headerlink" href="#making-the-spec" title="Permalink to this heading">#</a></h2>
<p>I’ve decided that I want string to work as close to how they do natively with the default setup in <a class="reference external" href="https://docs.python.org/3/library/configparser.html#module-configparser" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">configparser</span></code></a> except I want to be able to specify some extra types. I want <code class="docutils literal notranslate"><span class="pre">bool(True)</span></code> to automatically be converted to a python boolean and similar logic for <code class="docutils literal notranslate"><span class="pre">int(0)</span></code> and <code class="docutils literal notranslate"><span class="pre">float(1.0)</span></code> etc. To specify a string literal of the same text it would just look like this <code class="docutils literal notranslate"><span class="pre">'bool(True)'</span></code> and similarly any literal encapsulated in unescaped quotes will just be interpreted as a literal string.</p>
<p>We’ll compare the Spec we make here to the json spec since it has a bit more going on with it. The json spec uses the default values so this is just the first couple lines of the abstract-ish <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec" title="grave_settings.formatter_settings.FormatterSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterSpec</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Json spec</span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="k">class</span> <span class="nc">FormatterSpec</span><span class="p">:</span>
      <span class="n">ROUTE_PATH_TRANSLATION</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span>
          <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span>
          <span class="s1">&#39;.&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\.&#39;</span><span class="p">,</span>
          <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\&quot;&#39;</span>
      <span class="p">})</span>
      <span class="n">ROUTE_PATH_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:[^\.&quot;]|&quot;(?:</span><span class="se">\\</span><span class="s1">.|[^&quot;])*&quot;)+&#39;</span><span class="p">)</span>
      <span class="n">PRIMITIVES</span> <span class="o">=</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">NoneType</span>
      <span class="n">SPECIAL</span> <span class="o">=</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span>
      <span class="n">ATTRIBUTE</span> <span class="o">=</span> <span class="nb">str</span>

      <span class="n">TYPES</span> <span class="o">=</span> <span class="n">PRIMITIVES</span> <span class="o">|</span> <span class="n">SPECIAL</span>
</pre></div>
</div>
</div>
<p>Since I want to do weird things like have no primitives (I cant say string is a primitive since strings have to be scanned to make sure they do not need to be escaped). I’ll make a custom Spec to hold this information</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Custom Spec</span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomSpec</span><span class="p">(</span><span class="n">FormatterSpec</span><span class="p">):</span>
    <span class="n">PRIMITIVES</span> <span class="o">=</span> <span class="n">Never</span>  <span class="c1"># [1]</span>
    <span class="n">SPECIAL</span> <span class="o">=</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># [1]</span>
    <span class="n">ATTRIBUTE</span> <span class="o">=</span> <span class="nb">str</span>  <span class="c1"># [1]</span>

    <span class="n">TYPES</span> <span class="o">=</span> <span class="n">PRIMITIVES</span> <span class="o">|</span> <span class="n">SPECIAL</span>

    <span class="n">SPECIAL_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(int|float|None|bool|</span><span class="se">\&#39;</span><span class="s1">|\&quot;)&#39;</span><span class="p">)</span>  <span class="c1"># [2]</span>

    <span class="k">def</span> <span class="nf">get_primitive_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="admonition-note-1 admonition">
<p class="admonition-title">Note [1]</p>
<p>These values are not required. Previously they have been used for type hints and and other non-strict organizational purposes, but the default <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec" title="grave_settings.formatter_settings.FormatterSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterSpec</span></code></a> does use them in the methods <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec.get_primitive_types" title="grave_settings.formatter_settings.FormatterSpec.get_primitive_types"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_primitive_types()</span></code></a> and <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec.get_special_types" title="grave_settings.formatter_settings.FormatterSpec.get_special_types"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_special_types()</span></code></a> methods. The methods returning the correct values are all that matters</p>
</div>
<div class="admonition-note-2 admonition">
<p class="admonition-title">Note [2]</p>
<p>This regex will be used to tell if a string is following our custom rules or if it is just a literal string.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="n">FORMAT_SETTINGS</span> <span class="o">=</span> <span class="n">CustomSpec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">serialized_obj_to_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ser_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read_dict</span><span class="p">(</span><span class="n">ser_obj</span><span class="p">)</span>
        <span class="n">strio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strio</span><span class="p">)</span>
        <span class="n">strio</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strio</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">buffer_to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_obj</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Serializer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CustomSerializer</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Not looking amazing so far, we might want to put some finishing touches on this later, but lets move on to the actual serialization and deserialization logic. We are going to have to modify Serializer and Deserializer quite a bit since the format is so limited. Lets get serialization working first.</p>
</section>
<section id="custom-serializer">
<h2>Custom Serializer<a class="headerlink" href="#custom-serializer" title="Permalink to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_object</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">CustomSpec</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_object</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">:</span> <span class="n">CustomSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>  <span class="c1"># PyCharm bug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">add_handlers_by_type_hints</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_float</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_bool</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_none</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">handle_user_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">SPECIAL_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_serialize_dict_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [1]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_serialize_dict_in_place</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_dict_for_flat_dict</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">handle_serialize_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [2]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_serialize_default</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_dict_for_flat_dict</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">skim_dict_for_flat_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">prims</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">}</span>
        <span class="n">this_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">path_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">key_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="n">this_path</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prims</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="n">this_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">prims</span>
        <span class="k">return</span> <span class="n">prims</span>

    <span class="k">def</span> <span class="nf">handle_user_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">handle_user_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;bool(</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">handle_user_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;int(</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">handle_user_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;float(</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">handle_user_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">NoneType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="s1">&#39;MAIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not confuse the handler attribute of this <code class="docutils literal notranslate"><span class="pre">CustomSerializer</span></code> as the Handler that is is accessible from <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> through it’s property <code class="docutils literal notranslate"><span class="pre">handler</span></code>, truly belonging to <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a>. The handler on <code class="docutils literal notranslate"><span class="pre">CustomSerializer</span></code> is used like a fancy switch statement to decide which methods handle certain types. In some cases the handlers attached use the Handler on <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a> in their method bodies.</p>
</div>
<div class="admonition-note-1 admonition">
<p class="admonition-title">Note [1]</p>
<p>The <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer" title="grave_settings.formatter.Serializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></a> we are inheriting from ultimately calls <code class="docutils literal notranslate"><span class="pre">handle_serialize_dict_in_place</span></code> for both <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> dicts and user dicts. Overriding it and calling super will let all of the machinery for dicts in the super class do its thing and we will modify the data for our use case.</p>
</div>
<div class="admonition-note-2 admonition">
<p class="admonition-title">Note [2]</p>
<p>Custom objects go through the <code class="docutils literal notranslate"><span class="pre">handle_serialize_default</span></code> method in the super class so we will intercept this one also. If it were not for the <a class="reference external" href="https://docs.python.org/3/library/configparser.html#configparser.ConfigParser" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> disliking nested dictionaries we could probably side step most of this</p>
</div>
<p>The <a class="reference external" href="https://docs.python.org/3/library/configparser.html#configparser.ConfigParser" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> wants to work in terms of a flat dictionary with keys being the major sections in the ini file and the values being <code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">str]</span></code>. This differs from how json and toml want their data structures set up but that is why we added a new attribute <code class="docutils literal notranslate"><span class="pre">flat_dict</span></code> and intercept the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer.process" title="grave_settings.formatter.Serializer.process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process()</span></code></a> method.</p>
<p>I have chosen to add <code class="docutils literal notranslate"><span class="pre">handle_user_list</span></code> later, and I would also like to change how the <code class="docutils literal notranslate"><span class="pre">CustomSpec</span></code> formats the key paths. Take a look at the example below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">formatter</span> <span class="o">=</span> <span class="n">CustomFormatter</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;bool&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;custom handled&#39;</span><span class="p">:</span> <span class="n">CustomFormatter</span><span class="p">,</span>
        <span class="s1">&#39;pesky string&#39;</span><span class="p">:</span> <span class="s1">&#39;bool(True)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;quote char&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;other quote char&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;baz&quot;</span><span class="o">.</span><span class="s2">&quot;custom handled&quot;</span><span class="p">]</span>
<span class="vm">__class__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">__main__</span><span class="o">.</span><span class="n">CustomFormatter</span>

<span class="p">[</span><span class="s2">&quot;baz&quot;</span><span class="p">]</span>
<span class="nb">str</span> <span class="o">=</span> <span class="n">a</span> <span class="n">string</span>
<span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="nb">bool</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pesky</span> <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;bool(True)&#39;</span>
<span class="n">quote</span> <span class="n">char</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span>
<span class="n">other</span> <span class="n">quote</span> <span class="n">char</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span>

<span class="p">[</span><span class="n">MAIN</span><span class="p">]</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">bar</span>
</pre></div>
</div>
</div>
<p>The first thing I notice is that the headers are in the reverse order I would like. Solving this is probably best done in post (using <a class="reference external" href="https://docs.python.org/3/library/configparser.html#configparser.ConfigParser" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> or the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Formatter" title="grave_settings.formatter.Formatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Formatter</span></code></a>). The second thing is I dont like the quotes in the path names. We’ll address both of these gripes later.</p>
</section>
<section id="custom-deserializer">
<h2>Custom DeSerializer<a class="headerlink" href="#custom-deserializer" title="Permalink to this heading">#</a></h2>
<p>Lets see if we can turn that string back into a python object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomDeSerializer</span><span class="p">(</span><span class="n">DeSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_object</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">FormatterSpec</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_object</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">:</span> <span class="n">CustomSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>  <span class="c1"># PyCharm bug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">add_handlers_by_type_hints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_handler</span><span class="o">.</span><span class="n">add_handlers_by_type_hints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_secondary_prim</span><span class="p">)</span>

    <span class="nd">@DeSerializer</span><span class="o">.</span><span class="n">root_obj</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">root_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_obj</span><span class="p">):</span>  <span class="c1"># [1]</span>
        <span class="n">root_obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="p">:</span>
            <span class="n">root_obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;MAIN&#39;</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;MAIN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">main</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">root_obj</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_obj</span> <span class="o">=</span> <span class="n">main</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># [2]</span>
        <span class="n">work</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">str_2_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">str_to_path</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nest</span> <span class="o">=</span> <span class="n">work</span>
            <span class="n">p_nest</span> <span class="o">=</span> <span class="n">nest</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">str_2_p</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">part</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nest</span><span class="p">:</span>
                    <span class="n">nest</span><span class="p">[</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">p_nest</span> <span class="o">=</span> <span class="n">nest</span>
                <span class="n">nest</span> <span class="o">=</span> <span class="n">nest</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">p_nest</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">work</span>

    <span class="k">def</span> <span class="nf">handle_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [3]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">SPECIAL_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_secondary_prim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">NoneType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [4]</span>
        <span class="k">return</span> <span class="n">instance</span>
</pre></div>
</div>
<div class="admonition-note-1 admonition">
<p class="admonition-title">Note [1]</p>
<p>This is overriding <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Processor" title="grave_settings.formatter.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a>’s property. This is a simple way to turn the “flattened” dictionary-like object into a nested dictionary structure. The <a class="reference external" href="https://docs.python.org/3/library/configparser.html#configparser.ConfigParser" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigParser</span></code></a> adds some extra stuff into dictionary-like object is uses, so they are stripped out</p>
</div>
<div class="admonition-note-2 admonition">
<p class="admonition-title">Note [2]</p>
<p>This is the method that will convert the key paths in the flattened dictionary to the nested dictionary. Unfortunestly the dictionary-like objects do not cooperate fully with the interface of a dictionary so they cannot be left as-is</p>
</div>
<div class="admonition-note-3 admonition">
<p class="admonition-title">Note [3]</p>
<p>There is almost certainly a better way to do this, but hey, this is just an example. This undoes our custom strings that are meant to represent types</p>
</div>
<div class="admonition-note-4 admonition">
<p class="admonition-title">Note [4]</p>
<p>This handler is attached to the <code class="docutils literal notranslate"><span class="pre">secondary_handler</span></code>. The <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.DeSerializer" title="grave_settings.formatter.DeSerializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeSerializer</span></code></a> has two handlers. This is for dealing with things like <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.PreservedReference" title="grave_settings.formatter_settings.PreservedReference"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreservedReference</span></code></a> and caching object paths for fixing reference issues. This method keeps the primitives from being cached for references since this is meant only for higher level objects.</p>
</div>
<p>Now lets ass this method to the custom formatter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_deserializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_obj</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomDeSerializer</span><span class="p">:</span>
  <span class="k">return</span> <span class="n">CustomDeSerializer</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>and we’ll try to deserialize our string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">formatter</span> <span class="o">=</span> <span class="n">CustomFormatter</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;bool&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;custom handled&#39;</span><span class="p">:</span> <span class="n">CustomFormatter</span><span class="p">,</span>
        <span class="s1">&#39;pesky string&#39;</span><span class="p">:</span> <span class="s1">&#39;bool(True)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;quote char&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;other quote char&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;&#39;</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  {&#39;baz&#39;: {&#39;None&#39;: None,
           &#39;bool&#39;: True,
           &#39;custom handled&#39;: &lt;class &#39;__main__.CustomFormatter&#39;&gt;,
           &#39;int&#39;: 1,
           &#39;other quote char&#39;: &#39;&quot;&#39;,
           &#39;pesky string&#39;: &#39;bool(True)&#39;,
           &#39;quote char&#39;: &quot;&#39;&quot;,
           &#39;str&#39;: &#39;a string&#39;},
   &#39;foo&#39;: &#39;bar&#39;}
</pre></div>
</div>
</div>
</section>
<section id="wrapping-things-up">
<h2>Wrapping things up<a class="headerlink" href="#wrapping-things-up" title="Permalink to this heading">#</a></h2>
<p>Finally, we have the full code with some of the blemishes patched up.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">NoneType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Never</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">grave_settings.abstract</span> <span class="kn">import</span> <span class="n">Serializable</span>
<span class="kn">from</span> <span class="nn">grave_settings.formatter</span> <span class="kn">import</span> <span class="n">Formatter</span><span class="p">,</span> <span class="n">Serializer</span><span class="p">,</span> <span class="n">DeSerializer</span>
<span class="kn">from</span> <span class="nn">grave_settings.formatter_settings</span> <span class="kn">import</span> <span class="n">FormatterContext</span><span class="p">,</span> <span class="n">FormatterSpec</span>


<span class="k">class</span> <span class="nc">CustomSpec</span><span class="p">(</span><span class="n">FormatterSpec</span><span class="p">):</span>
    <span class="n">PRIMITIVES</span> <span class="o">=</span> <span class="n">Never</span>
    <span class="n">SPECIAL</span> <span class="o">=</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">ATTRIBUTE</span> <span class="o">=</span> <span class="nb">str</span>

    <span class="n">TYPES</span> <span class="o">=</span> <span class="n">PRIMITIVES</span> <span class="o">|</span> <span class="n">SPECIAL</span>

    <span class="n">SPECIAL_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(int|float|None|bool|</span><span class="se">\&#39;</span><span class="s1">|\&quot;)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_primitive_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">path_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_path</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROUTE_PATH_TRANSLATION</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">key_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">str_to_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROUTE_PATH_REGEX</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">reference</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">ListAsDict</span><span class="p">(</span><span class="n">Serializable</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">li</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">li</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">li</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state_obj</span><span class="p">)):</span>
            <span class="n">li</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_obj</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span> <span class="o">=</span> <span class="n">li</span>


<span class="k">class</span> <span class="nc">CustomSerializer</span><span class="p">(</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_object</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">CustomSpec</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_object</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">:</span> <span class="n">CustomSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>  <span class="c1"># PyCharm bug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">add_handlers_by_type_hints</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_float</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_bool</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_none</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_user_str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">handle_user_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">SPECIAL_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_serialize_dict_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [1]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_serialize_dict_in_place</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_dict_for_flat_dict</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">handle_serialize_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [2]</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_serialize_default</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skim_dict_for_flat_dict</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">skim_dict_for_flat_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">prims</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">}</span>
        <span class="n">this_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">path_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">key_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">:</span>  <span class="c1"># [3]</span>
            <span class="n">prims</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="n">this_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="n">this_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">prims</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="n">this_path</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">handle_serialize_list_in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_serialize_default</span><span class="p">(</span><span class="n">ListAsDict</span><span class="p">(</span><span class="n">li</span><span class="o">=</span><span class="n">instance</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">handle_user_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;bool(</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">handle_user_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;int(</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">handle_user_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;float(</span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="nf">handle_user_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">NoneType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="p">[</span><span class="s1">&#39;MAIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flat_dict</span>


<span class="k">class</span> <span class="nc">CustomDeSerializer</span><span class="p">(</span><span class="n">DeSerializer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_object</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="n">FormatterSpec</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">root_object</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="p">:</span> <span class="n">CustomSpec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span>  <span class="c1"># PyCharm bug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">add_handlers_by_type_hints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_handler</span><span class="o">.</span><span class="n">add_handlers_by_type_hints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_secondary_prim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_secondary_list_as_dict</span><span class="p">)</span>

    <span class="nd">@DeSerializer</span><span class="o">.</span><span class="n">root_obj</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">root_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_obj</span><span class="p">):</span>  <span class="c1"># [1]</span>
        <span class="n">root_obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="p">:</span>
            <span class="n">root_obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;MAIN&#39;</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">root_obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;MAIN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">main</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">root_obj</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_obj</span> <span class="o">=</span> <span class="n">main</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># [2]</span>
        <span class="n">work</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">str_2_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">str_to_path</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nest</span> <span class="o">=</span> <span class="n">work</span>
            <span class="n">p_nest</span> <span class="o">=</span> <span class="n">nest</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">str_2_p</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">part</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nest</span><span class="p">:</span>
                    <span class="n">nest</span><span class="p">[</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">p_nest</span> <span class="o">=</span> <span class="n">nest</span>
                <span class="n">nest</span> <span class="o">=</span> <span class="n">nest</span><span class="p">[</span><span class="n">part</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">p_nest</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">work</span>

    <span class="k">def</span> <span class="nf">handle_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [3]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">match</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">SPECIAL_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">instance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_secondary_prim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">NoneType</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># [4]</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">handle_secondary_list_as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">ListAsDict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">list</span>


<span class="k">class</span> <span class="nc">CustomFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="n">FORMAT_SETTINGS</span> <span class="o">=</span> <span class="n">CustomSpec</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">serialized_obj_to_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ser_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read_dict</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">ser_obj</span><span class="o">.</span><span class="n">items</span><span class="p">())})</span>
        <span class="n">strio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strio</span><span class="p">)</span>
        <span class="n">strio</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strio</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">buffer_to_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">(</span><span class="n">default_section</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">get_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_obj</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">FormatterContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Serializer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CustomSerializer</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_deserializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_obj</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomDeSerializer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CustomDeSerializer</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">context</span><span class="p">)</span>

<span class="n">formatter</span> <span class="o">=</span> <span class="n">CustomFormatter</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;bool&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;custom handled&#39;</span><span class="p">:</span> <span class="n">CustomFormatter</span><span class="p">,</span>
        <span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="s1">&#39;pesky string&#39;</span><span class="p">:</span> <span class="s1">&#39;bool(True)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;quote char&#39;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s1">&#39;other quote char&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;a list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  [MAIN]
  foo = bar

  [baz]
  str = a string
  None = None
  bool = bool(True)
  int = int(1)
  pesky string = &#39;bool(True)&#39;
  quote char = &quot;&#39;&quot;
  other quote char = &#39;&quot;&#39;

  [baz.a list]
  __class__ = __main__.ListAsDict
  0 = int(1)
  1 = int(2)
  2 = int(3)
  3 = int(4)
  4 = int(5)

  [baz.datetime]
  __class__ = datetime.datetime

  [baz.datetime.state]
  __class__ = __main__.ListAsDict
  0 = int(2023)
  1 = int(1)
  2 = int(24)
  3 = int(1)
  4 = int(35)
  5 = int(25)
  6 = int(79852)

  [baz.custom handled]
  __class__ = abc.ABCMeta
  state = __main__.CustomFormatter


  {&#39;baz&#39;: {&#39;None&#39;: None,
           &#39;a list&#39;: [1, 2, 3, 4, 5],
           &#39;bool&#39;: True,
           &#39;custom handled&#39;: &lt;class &#39;__main__.CustomFormatter&#39;&gt;,
           &#39;datetime&#39;: datetime.datetime(2023, 1, 24, 1, 35, 25, 79852),
           &#39;int&#39;: 1,
           &#39;other quote char&#39;: &#39;&quot;&#39;,
           &#39;pesky string&#39;: &#39;bool(True)&#39;,
           &#39;quote char&#39;: &quot;&#39;&quot;,
           &#39;str&#39;: &#39;a string&#39;},
   &#39;foo&#39;: &#39;bar&#39;}
</pre></div>
</div>
</div>
<div class="admonition-final-note admonition">
<p class="admonition-title">Final Note</p>
<p>What a mouthful! Who made this stupid framework?</p>
</div>
<p>This implementation has several problems including that escaping “bad strings” is not given any consideration, but I think it did a decent job hitting the concepts needed to extend the formatting classes.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Documentation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="using_handlers.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Using Handlers</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Ryan McConnell
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Custom Formatter</a><ul>
<li><a class="reference internal" href="#making-the-spec">Making the Spec</a></li>
<li><a class="reference internal" href="#custom-serializer">Custom Serializer</a></li>
<li><a class="reference internal" href="#custom-deserializer">Custom DeSerializer</a></li>
<li><a class="reference internal" href="#wrapping-things-up">Wrapping things up</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    </body>
</html>