<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Circular References" href="circular_references.html" /><link rel="prev" title="Config File Example" href="using_config_file.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Preserving References - grave_settings 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">grave_settings 0.1.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">grave_settings 0.1.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Directory</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../limitations.html">Limitations</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../limitations/security_concerns.html">Security Concerns</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_reference.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/semantics.html">Semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/handlers.html">Handler Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/formatters.html">Formatters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/bases.html">User Object Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/conversion_manager.html">Conversion Manager</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="settings_base_classes.html">Settings Bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_config_file.html">Config File Example</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Preserving References</a></li>
<li class="toctree-l2"><a class="reference internal" href="circular_references.html">Circular References</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_handlers.html">Using Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="building_a_formatter.html">Custom Formatter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.abstract.html">abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.config_file.html">config_file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.conversion_manager.html">conversion_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.default_handlers.html">default_handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.formatter.html">formatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.formatter_settings.html">formatter_settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.framestack_context.html">framestack_context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.helper_objects.html">helper_objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.semantics.html">semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.utilities.html">utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.validation.html">validation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/modules.html">Formatters</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="preserving-references">
<h1>Preserving References<a class="headerlink" href="#preserving-references" title="Permalink to this heading">#</a></h1>
<p>Preserving references means maintaining “is” relationships through the serialization / deserialization process. The automatic preserving of references is managed by the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Processor" title="grave_settings.formatter.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a> and the behavior is set by the following <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.Semantic" title="grave_settings.semantics.Semantic"><code class="xref py py-class docutils literal notranslate"><span class="pre">Semantics</span></code></a>:</p>
<p><a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.AutoPreserveReferences" title="grave_settings.semantics.AutoPreserveReferences"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoPreserveReferences</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AutoPreserveReferences</span><span class="p">(</span><span class="n">Semantic</span><span class="p">[</span><span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The formatter will keep track of objects that are referenced more than once in the object hierarchy and automatically</span>
<span class="sd">    convert subsequent instanced of the same object to a PreservedReference</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.ResolvePreservedReferences" title="grave_settings.semantics.ResolvePreservedReferences"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResolvePreservedReferences</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ResolvePreservedReferences</span><span class="p">(</span><span class="n">Semantic</span><span class="p">[</span><span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preserved References are resolved by the formatter and never given to the object. This may be slower. but</span>
<span class="sd">    it ensures that the object will never have a property set that is of type PreservedReference. When this is not</span>
<span class="sd">    present the formatter should not resolve the preserved references. Objects can resolve them by subscribing to the</span>
<span class="sd">    context objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.DetonateDanglingPreservedReferences" title="grave_settings.semantics.DetonateDanglingPreservedReferences"><code class="xref py py-class docutils literal notranslate"><span class="pre">DetonateDanglingPreservedReferences</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DetonateDanglingPreservedReferences</span><span class="p">(</span><span class="n">Semantic</span><span class="p">[</span><span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This will call a method that raises an exception if any tracked PreservedReference has not been flagged for garbage</span>
<span class="sd">    collection at the end of the deserialization process. It can be used to test if all the PreservedReference objects</span>
<span class="sd">    have been replaced by their correct reference since they should all be de-referenced by the end of the process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.EnforceReferenceLifecycle" title="grave_settings.semantics.EnforceReferenceLifecycle"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnforceReferenceLifecycle</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EnforceReferenceLifecycle</span><span class="p">(</span><span class="n">Semantic</span><span class="p">[</span><span class="nb">bool</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures that an object id that is used to cache an object for PreservedReferences is not re-used by the interpreter</span>
<span class="sd">    by maintaining a reference to all objects cached for the duration of the operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I think it would be a bad idea to turn off <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.EnforceReferenceLifecycle" title="grave_settings.semantics.EnforceReferenceLifecycle"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnforceReferenceLifecycle</span></code></a>. The only rational for doing this I can think of would be to save on some time and memory complexity, but compared to the rest of the process this semantic is not expensive. It is confusing to determine when this semantic is necessary and its function is a safety net. It attempts to protect the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Processor" title="grave_settings.formatter.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a> from mixing up object ids, so when this semantic is turned off and the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Processor" title="grave_settings.formatter.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a> gets confused this will lead to data loss, crashes and undefined behavior as objects will be incorrectly referencing each other.</p>
</div>
<section id="simple-example">
<h2>Simple example<a class="headerlink" href="#simple-example" title="Permalink to this heading">#</a></h2>
<p>Lets serialize a data structure with duplicate references</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">grave_settings.formatters.json</span> <span class="kn">import</span> <span class="n">JsonFormatter</span>

<span class="n">some_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">some_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="n">some_list</span><span class="p">,</span>
    <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="n">some_list</span>
<span class="p">}</span>

<span class="n">formatter</span> <span class="o">=</span> <span class="n">JsonFormatter</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">some_dict</span><span class="p">))</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="p">{</span>
      <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">3</span>
      <span class="p">],</span>
      <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;__class__&quot;</span><span class="p">:</span> <span class="s2">&quot;grave_settings.formatter_settings.PreservedReference&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">foo</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The preserved reference object is simple but the a note about the <code class="docutils literal notranslate"><span class="pre">ref</span></code> attribute. It is not guaranteed that the <code class="docutils literal notranslate"><span class="pre">ref</span></code> attribute will follow any particular format, and so, we should not look at it directly or use it to make decisions without consulting the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec" title="grave_settings.formatter_settings.FormatterSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterSpec</span></code></a>. In most cases the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec" title="grave_settings.formatter_settings.FormatterSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterSpec</span></code></a> or <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> will expose methods that act as an abstraction layer. This is just an FYI that a formatter or file format may be set up to use a different <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterSpec" title="grave_settings.formatter_settings.FormatterSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterSpec</span></code></a> then what you may be anticipating if you choose to look at the <code class="docutils literal notranslate"><span class="pre">ref</span></code> value directly. In fact the formatter built in <a class="reference internal" href="building_a_formatter.html"><span class="doc">Custom Formatter</span></a> does not follow the default behavior.</p>
</div>
<p>This way when the structure is deserialized <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> will be associated with the same list object as opposed to two separate lists with the same values. Note that this can be weird if you are deserializing <a class="reference internal" href="circular_references.html"><span class="doc">Circular References</span></a></p>
</section>
<section id="not-preserving-references">
<h2>Not preserving references<a class="headerlink" href="#not-preserving-references" title="Permalink to this heading">#</a></h2>
<p>Lets have a quick look at the output if the <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.AutoPreserveReferences" title="grave_settings.semantics.AutoPreserveReferences"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoPreserveReferences</span></code></a> semantic was disabled</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">grave_settings.formatters.json</span> <span class="kn">import</span> <span class="n">JsonFormatter</span>
<span class="kn">from</span> <span class="nn">grave_settings.semantics</span> <span class="kn">import</span> <span class="n">AutoPreserveReferences</span>

<span class="n">some_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">some_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="n">some_list</span><span class="p">,</span>
    <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="n">some_list</span>
<span class="p">}</span>

<span class="n">formatter</span> <span class="o">=</span> <span class="n">JsonFormatter</span><span class="p">()</span>
<span class="n">formatter</span><span class="o">.</span><span class="n">add_semantics</span><span class="p">(</span><span class="n">AutoPreserveReferences</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>  <span class="c1"># [1]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">some_dict</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition-note-1 admonition">
<p class="admonition-title">Note [1]</p>
<p>Adding the <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.AutoPreserveReferences" title="grave_settings.semantics.AutoPreserveReferences"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoPreserveReferences</span></code></a> on the formatter sets is as a default <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.Semantic" title="grave_settings.semantics.Semantic"><code class="xref py py-class docutils literal notranslate"><span class="pre">Semantic</span></code></a> for this formatter object. The <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer" title="grave_settings.formatter.Serializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></a> <code class="docutils literal notranslate"><span class="pre">Processor</span></code> has this set to <code class="docutils literal notranslate"><span class="pre">True</span></code> by default but the formatter defaults will override it. This effectively adds the Semantic to the root frame, not as a frame semantic, meaning that it will propigat through the entire process. No reference will be preserved in the entire hierarchy.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">{</span>
      <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">3</span>
      <span class="p">],</span>
      <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">3</span>
      <span class="p">]</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="disabling-preserved-references-dynamically">
<h2>Disabling preserved references dynamically<a class="headerlink" href="#disabling-preserved-references-dynamically" title="Permalink to this heading">#</a></h2>
<p>Now lets say that you have two objects that reference two two separately identical objects. With one list you want to preserve the reference but with the other you do not. How to we accomplish this?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">grave_settings.formatter_settings</span> <span class="kn">import</span> <span class="n">NoRef</span>
<span class="kn">from</span> <span class="nn">grave_settings.formatters.json</span> <span class="kn">import</span> <span class="n">JsonFormatter</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;list1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">list1</span><span class="p">,</span>
            <span class="s1">&#39;list2&#39;</span><span class="p">:</span> <span class="n">NoRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list2</span><span class="p">)</span>
        <span class="p">}</span>


<span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list1</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">list1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list2</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">list2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;list1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">list1</span><span class="p">,</span>
            <span class="s1">&#39;list2&#39;</span><span class="p">:</span> <span class="n">NoRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list2</span><span class="p">),</span>
            <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">foo</span>
        <span class="p">}</span>


<span class="n">formatter</span> <span class="o">=</span> <span class="n">JsonFormatter</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">())))</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Output</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">{</span>
      <span class="s2">&quot;__class__&quot;</span><span class="p">:</span> <span class="s2">&quot;__main__.Bar&quot;</span><span class="p">,</span>
      <span class="s2">&quot;list1&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">3</span>
      <span class="p">],</span>
      <span class="s2">&quot;list2&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="mi">1</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">,</span>
          <span class="mi">3</span>
      <span class="p">],</span>
      <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;__class__&quot;</span><span class="p">:</span> <span class="s2">&quot;__main__.Foo&quot;</span><span class="p">,</span>
          <span class="s2">&quot;list1&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;__class__&quot;</span><span class="p">:</span> <span class="s2">&quot;grave_settings.formatter_settings.PreservedReference&quot;</span><span class="p">,</span>
              <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">list1</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;list2&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="mi">1</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">,</span>
              <span class="mi">3</span>
          <span class="p">]</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<p id="norefexample">By wrapping the lists in <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.NoRef" title="grave_settings.formatter_settings.NoRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoRef</span></code></a> objects the formatter is instructed to disable preserved references for this object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.NoRef" title="grave_settings.formatter_settings.NoRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoRef</span></code></a> is a simple subclass of <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.AddSemantics" title="grave_settings.formatter_settings.AddSemantics"><code class="xref py py-class docutils literal notranslate"><span class="pre">AddSemantics</span></code></a> which acts in a similar manner, but allows you to attach arbitrary semantics to the wrapped object.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The same effect can be achieved for the above by using <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> instead of <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.NoRef" title="grave_settings.formatter_settings.NoRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">NoRef</span></code></a> but this is only because it is a special case. If the list contained python objects or any other values that the formatter may transform during its operation, then the original objects will have data overriden. This is because <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> signals to the formatter that, not only is the object not referencable, but it also can safely be mutated and destroyed. It “belongs” to the formatter after the formatter unwraps it. <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> is typically used in <a class="reference internal" href="using_handlers.html"><span class="doc">handlers</span></a></p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="circular_references.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Circular References</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="using_config_file.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Config File Example</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Ryan McConnell
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Preserving References</a><ul>
<li><a class="reference internal" href="#simple-example">Simple example</a></li>
<li><a class="reference internal" href="#not-preserving-references">Not preserving references</a></li>
<li><a class="reference internal" href="#disabling-preserved-references-dynamically">Disabling preserved references dynamically</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    </body>
</html>