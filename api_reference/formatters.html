<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="User Object Base Classes" href="bases.html" /><link rel="prev" title="Handler Objects" href="handlers.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Formatters - grave_settings 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">grave_settings 0.1.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">grave_settings 0.1.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Directory</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../limitations.html">Limitations</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../limitations/security_concerns.html">Security Concerns</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../api_reference.html">API Reference</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="semantics.html">Semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="handlers.html">Handler Objects</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Formatters</a></li>
<li class="toctree-l2"><a class="reference internal" href="bases.html">User Object Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="conversion_manager.html">Conversion Manager</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/settings_base_classes.html">Settings Bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/using_config_file.html">Config File Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/preserving_references.html">Preserving References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/circular_references.html">Circular References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/using_handlers.html">Using Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/building_a_formatter.html">Custom Formatter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.abstract.html">abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.config_file.html">config_file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.conversion_manager.html">conversion_manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.default_handlers.html">default_handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.formatter.html">formatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.formatter_settings.html">formatter_settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.framestack_context.html">framestack_context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.handlers.html">handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.helper_objects.html">helper_objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.semantics.html">semantics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.utilities.html">utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/grave_settings.validation.html">validation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/modules.html">Formatters</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="formatters">
<h1>Formatters<a class="headerlink" href="#formatters" title="Permalink to this heading">#</a></h1>
<p>A formatter can be made by implementing the interface of <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.IFormatter" title="grave_settings.formatter.IFormatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">IFormatter</span></code></a>. A completely custom formatter that does not use the pre-made base class <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Formatter" title="grave_settings.formatter.Formatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Formatter</span></code></a> will still have to acknowledge the interface of <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> to maintain compatibility of user objects that are adhering to the interface of <a class="reference internal" href="../api/grave_settings.abstract.html#grave_settings.abstract.Serializable" title="grave_settings.abstract.Serializable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializable</span></code></a>.</p>
<p>The base class <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Formatter" title="grave_settings.formatter.Formatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Formatter</span></code></a> was made to be the boiler plate for all of my intents and purposes, so all of my writings are going to be from the perspective of inheriting from <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Formatter" title="grave_settings.formatter.Formatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Formatter</span></code></a>.</p>
<section id="basic-anatomy">
<h2>Basic Anatomy<a class="headerlink" href="#basic-anatomy" title="Permalink to this heading">#</a></h2>
<p>The basic formatter consists of a subclass of <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Formatter" title="grave_settings.formatter.Formatter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Formatter</span></code></a>, one or more <code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code> and a <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a>. The formatter is meant to be used multiple times after instantiation for different operations and allow the user to manage default values for the processes it manages. The Processors are meant to be used once and then disposed, since they are objects that only exist to do the work of <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.IFormatter.serialize" title="grave_settings.formatter.IFormatter.serialize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serialize()</span></code></a> and <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.IFormatter.deserialize" title="grave_settings.formatter.IFormatter.deserialize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">deserialize()</span></code></a>. The <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> and <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a> are manged by the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Processor" title="grave_settings.formatter.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a> and are created along with them. The Processors and the objects they manage can be safely used to manage state throughout a processing job. They are not designed to be multi-threaded or reused so that is safe.</p>
<p>The design of the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Processor" title="grave_settings.formatter.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a> is a little bit confusing because it uses recursion to walk through the object hierarchy, but it also uses multiple stacks (in the form of <code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code> and the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a>. This is for two reasons. The first is that the user objects adhering to <a class="reference internal" href="../api/grave_settings.abstract.html#grave_settings.abstract.Serializable" title="grave_settings.abstract.Serializable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializable</span></code></a> need to be exposed to some of the information in the process but not all of it and the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> has the responsibility of exposing these features to them. Also the custom managed stacks simply do not exactly have the same timings and organisational needs as the function call stack.</p>
</section>
<section id="role-of-context-managers">
<h2>Role of context managers<a class="headerlink" href="#role-of-context-managers" title="Permalink to this heading">#</a></h2>
<p>To push and pop from the contexts mentioned above they implement the <a class="reference external" href="https://docs.python.org/3/library/contextlib.html#contextlib.AbstractContextManager" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span> <span class="pre">Manager</span> <span class="pre">Interface</span></code></a>. The <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> is typically meant to be called when entered and supplied a “path key”. The <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> keeps track of the logical path of a process. The default meaning of this is the objects that would be used by <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> to retrieve the current object from its parent (this is not a strict definition). This is used for referencing objects in a different sections of the hierarchy, navigating the hierarchy and retrieving objects by a unique path.</p>
<p>Even though an instance of <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a> is a member of the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a>, the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.FormatterContext" title="grave_settings.formatter_settings.FormatterContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext</span></code></a> does not manage the <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a>. It is there so that user objects can interact using <code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code> is responsible for using the <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a> like a context manager and the reference is held in the Processor in the attribute <code class="docutils literal notranslate"><span class="pre">semantics</span></code>. The stack on the <a class="reference internal" href="../api/grave_settings.framestack_context.html#grave_settings.framestack_context.FrameStackContext" title="grave_settings.framestack_context.FrameStackContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrameStackContext</span></code></a> holds collections of <code class="xref py py-class docutils literal notranslate"><span class="pre">DeSerializationHandler</span></code> or <a class="reference internal" href="../api/grave_settings.default_handlers.html#grave_settings.default_handlers.SerializationHandler" title="grave_settings.default_handlers.SerializationHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerializationHandler</span></code></a>). This encourages handlers and semantics to propagate down-stream but not upstream.</p>
</section>
<section id="concessions-for-references">
<h2>Concessions for references<a class="headerlink" href="#concessions-for-references" title="Permalink to this heading">#</a></h2>
<p>The implementation of Formatter would be fairly straight forward if it were not for two issues, one affecting serialization and the other deserialization. Both issues involve preserving object references.</p>
<section id="serialization-references">
<h3>Serialization &amp; references<a class="headerlink" href="#serialization-references" title="Permalink to this heading">#</a></h3>
<p>The serialization process has to keep track of all the ids that may be references more then once, but it does not know where an object “comes from.” By this I mean it has no knowledge of if a “dict” object it observes was created in a handler, to_dict() method (during the serialization process) or if is referenced by the original object hierarchy. I will explain why it is highly encouraged to treat these two kinds of object differently. We determine uniqueness by reading object ids with the built-in id() function. The problem is that if we dereference an object after we cached its object id, when a new object is created it will probably take the id of the object that was just dereferenced causing incorrect connections between referenced objects. This is mitigated by making sure that all objects who’s ids are cached ultimately have the same “lifecycle” as all other objects that are cached. This is easy enough, we just add them to a set (this can be turned off since it <em>shouldn’t</em> be necessary <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.EnforceReferenceLifecycle" title="grave_settings.semantics.EnforceReferenceLifecycle"><code class="xref py py-class docutils literal notranslate"><span class="pre">EnforceReferenceLifecycle</span></code></a>).</p>
<blockquote>
<div><p>Here in lies the next problem. If we add all the objects that are processed to a collection thus maintaining their lifecycle then we are pretty much doubling our memory footprint, for objects that would have been dereferenced that is. Why are objects being dereferenced mid-process anyway? This is because some objects are made by functions like handlers that make objects purely to communicate structure to the formatter. If a data structure exists as a python objects but it communicates its state as a dict, the dict and the original object are not the same and the generated dict is only going to live as long as the stack frame that asked for the state object to be created. If we can differentiate between these communicative objects (hence forth will be called <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> objects) and user referenced objects (like dicts that are directly referenced by user objects) we can avoid caching them. We can also do destructive things to these “temporary” objects because it can be assumed that once they are given to the formatter they “belong” to the formatter since they dont belong to anyone else at that point. We can save even more hassle by overwriting the container objects in place instead of creating yet another copy of the structure. The default <a class="reference internal" href="../api/grave_settings.default_handlers.html#grave_settings.default_handlers.SerializationHandler" title="grave_settings.default_handlers.SerializationHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">SerializationHandler</span></code></a> automatically wraps the return value of handlers in <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> objects see: <a class="reference internal" href="../examples/using_handlers.html#handlersandtemporary"><span class="std std-ref">This link for more info.</span></a> From this info mentioned in the link we can see that the way to communicate to the formatter that an object is temporary is to wrap it in a <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> object.</p>
</div></blockquote>
<p>The <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer" title="grave_settings.formatter.Serializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></a> Processor has special methods for dealing with <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.Temporary" title="grave_settings.formatter_settings.Temporary"><code class="xref py py-class docutils literal notranslate"><span class="pre">Temporary</span></code></a> objects. They are <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer.handle_serialize_list_in_place" title="grave_settings.formatter.Serializer.handle_serialize_list_in_place"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_serialize_list_in_place()</span></code></a>, <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer.handle_serialize_dict_in_place" title="grave_settings.formatter.Serializer.handle_serialize_dict_in_place"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_serialize_dict_in_place()</span></code></a> and <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer.handle_temporary" title="grave_settings.formatter.Serializer.handle_temporary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_temporary()</span></code></a>. The latter method is added to the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer" title="grave_settings.formatter.Serializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></a> handler (not to be confused with the <code class="xref py py-class docutils literal notranslate"><span class="pre">check_in_object</span></code> on non-temporary objects and the in-place logic runs immediately on them. The only other non-standard handler on the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer" title="grave_settings.formatter.Serializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></a> is <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.Serializer.handle_add_semantics" title="grave_settings.formatter.Serializer.handle_add_semantics"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_add_semantics()</span></code></a> which is partially <a class="reference internal" href="../examples/preserving_references.html#norefexample"><span class="std std-ref">explained here.</span></a> You can look at the <cite>__init__</cite> method for the handler setup.</p>
</section>
<section id="deserialization-references">
<h3>DeSerialization &amp; references<a class="headerlink" href="#deserialization-references" title="Permalink to this heading">#</a></h3>
<p>When the deserialization process encounters a preserved reference it is ideal to have that object already deserialized and sitting in the cache, but for a couple of reasons this may not be the case. The first case is that is simply has not reached the object yet, but if things were just in a different order it could have been prepared already. The second case is that it is not possible for object to have been prepared already regardless of the order because the object that is being referenced is currently being deserialized because it is a parent of the current object (this is a circular reference). These cases are handled separately by <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.DeSerializer" title="grave_settings.formatter.DeSerializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeSerializer</span></code></a>.</p>
<p>In the case of a circular reference, the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.PreservedReference" title="grave_settings.formatter_settings.PreservedReference"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreservedReference</span></code></a> is simply given to the object and the object is responsible for sorting it out using the <a class="reference internal" href="../api/grave_settings.semantics.html#grave_settings.semantics.NotifyFinalizedMethodName" title="grave_settings.semantics.NotifyFinalizedMethodName"><code class="xref py py-class docutils literal notranslate"><span class="pre">NotifyFinalizedMethodName</span></code></a> semantic and/or the <code class="xref py py-class docutils literal notranslate"><span class="pre">FormatterContext`s</span> <span class="pre">``finalize()`</span></code> event handler.</p>
<p>In the case of a non-circular reference, the process “jumps” to the location of the reference, deserializes it, replaces it with a <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.PreservedReference" title="grave_settings.formatter_settings.PreservedReference"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreservedReference</span></code></a> linked to the return key path and then returns to the return key path and gives it the fully deserialized object. This will have the effect that once the proces reaches the <a class="reference internal" href="../api/grave_settings.formatter_settings.html#grave_settings.formatter_settings.PreservedReference" title="grave_settings.formatter_settings.PreservedReference"><code class="xref py py-class docutils literal notranslate"><span class="pre">PreservedReference</span></code></a> that was left during the jump it will be guaranteed to successfully retrieve the object from the cache and proceed normally. This process, as well as several other conveniences are accomplished by the <a class="reference internal" href="../api/grave_settings.formatter.html#grave_settings.formatter.DeSerializer" title="grave_settings.formatter.DeSerializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeSerializer</span></code></a> having a two stage handling process. First an object is handed by the <code class="docutils literal notranslate"><span class="pre">handler</span></code> attribute then the <code class="docutils literal notranslate"><span class="pre">secondary_handler</span></code>.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="bases.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">User Object Base Classes</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="handlers.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Handler Objects</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Ryan McConnell
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Formatters</a><ul>
<li><a class="reference internal" href="#basic-anatomy">Basic Anatomy</a></li>
<li><a class="reference internal" href="#role-of-context-managers">Role of context managers</a></li>
<li><a class="reference internal" href="#concessions-for-references">Concessions for references</a><ul>
<li><a class="reference internal" href="#serialization-references">Serialization &amp; references</a></li>
<li><a class="reference internal" href="#deserialization-references">DeSerialization &amp; references</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    </body>
</html>